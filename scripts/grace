#!/usr/bin/env python

"""Grace Bot script

This script contains the commands needed to manage the bot.

Basic Commands:
    Bot Command(s):
        `start` : Starts the bot (`ctrl+c` to stop the bot)
    Database Command(s):
        `db create` : Creates the database and the tables
        `db delete` : Deletes the tables and the database
        `db seed` : Seeds the database tables (Initialize the default values)

All commands can takes the optional `-e` argument with a string, to define the environment.
Available environment: (production [default], development, test)
"""

from argparse import ArgumentParser
from bot.grace import start
from scripts.database import *


def load_application(env):
    """Set the environment by the given string (Available: 'production', 'development', 'test')"""
    app.load(env)
    info(f"Environment set to '{env}'")


if __name__ == '__main__':
    commands = {
        'start': start,
        "db create": create_all,
        "db drop": drop_all,
        "db seed": seed_tables,
        "db reset": reset,
    }
    parser = ArgumentParser()

    parser.add_argument('command', type=str, nargs="*", help="[CATEGORY (Optional)] [ACTION]")
    parser.add_argument(
        '-e',
        type=str,
        choices=["production", "development", "test"],
        help="-e environment (The default is production unless the BOT_ENV environment variable is defined)"
    )

    args = parser.parse_args()
    command = commands.get(' '.join(args.command))
    environment = args.e or "production"

    if command:
        app.load(environment)
        command()
    else:
        parser.error("Command not recognized")
